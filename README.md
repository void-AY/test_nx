# Nx Workspace с Микро-Репозиториями

## О проекте

Этот проект представляет собой Nx workspace, настроенный для работы с микро-репозиториями. Он включает в себя кастомные генераторы для создания React приложений и утилитарных библиотек с автоматической организацией в структурированную файловую систему.

## Что такое Nx?

[Nx](https://nx.dev) — это мощный инструмент для разработки в монорепозитории, который предоставляет:

- **Умное кэширование** — ускоряет сборку и тестирование
- **Граф зависимостей** — визуализирует связи между проектами
- **Генераторы кода** — автоматизирует создание проектов и компонентов
- **Исполнители задач** — оптимизирует выполнение команд
- **Плагины** — интеграция с популярными фреймворками

## Структура проекта

```
nx-workspace/
├── micro-repos/                    # Основная папка для всех микро-репозиториев
│   ├── apps/                       # React приложения
│   │   ├── my-app/
│   │   ├── test-counter/
│   │   └── ...
│   ├── e2e/                        # E2E тесты для приложений
│   │   ├── my-app-e2e/
│   │   ├── test-counter-e2e/
│   │   └── ...
│   └── libs/                       # Утилитарные библиотеки
│       ├── my-utils/
│       └── ...
├── workspace-generators/           # Кастомные генераторы
│   ├── counter-app.ts             # Генератор React приложений
│   ├── utils-lib.ts               # Генератор утилитарных библиотек
│   └── ...
└── ...
```

## Создание нового проекта

Для создания нового Nx workspace с микро-репозиториями и кастомными генераторами, следуйте подробной инструкции в файле [PROJECT_SETUP.md](./PROJECT_SETUP.md).

Краткий обзор:
1. Создание Nx workspace
2. Установка зависимостей
3. Настройка структуры проекта
4. Создание workspace генераторов
5. Настройка и создание первого приложения

## Доступные генераторы

### 1. counter-app

Создает новое React приложение со счетчиком.

**Использование:**
```bash
nx generate counter-app <название> --category=<категория>
```

**Параметры:**
- `name` (обязательный) - название приложения
- `category` (обязательный) - категория для организации (например: apps, tools)

**Пример:**
```bash
nx generate counter-app my-counter --category=apps
```

**Создает:**
- React приложение с Vite
- E2E тесты с Cypress
- Компонент счетчика с состоянием
- Стили и конфигурационные файлы

### 2. todo-app

Создает React приложение с функциональностью todo-списка, включая добавление, редактирование, удаление задач, фильтрацию по статусу и систему приоритетов.

**Использование:**
```bash
nx generate todo-app <название> [опции]
```

**Параметры:**
- `name` (обязательный) — название приложения
- `category` — категория проекта (по умолчанию: "apps")
- `title` — заголовок приложения (по умолчанию: "Todo App")
- `enableFilters` — включить фильтрацию по статусу (по умолчанию: true)
- `enablePriority` — включить систему приоритетов (по умолчанию: true)

**Примеры:**
```bash
# Создать базовое todo приложение
nx generate todo-app my-todo --category=apps

# Создать приложение с кастомным заголовком
nx generate todo-app project-tasks --title="Задачи проекта" --category=apps

# Создать приложение без системы приоритетов
nx generate todo-app simple-todo --enablePriority=false --category=apps

# Создать приложение только с базовой функциональностью
nx generate todo-app basic-todo --enableFilters=false --enablePriority=false --category=apps
```

**Создает:**
- React приложение с Vite
- E2E тесты с Cypress
- Компонент TodoApp с полной функциональностью:
  - Добавление новых задач
  - Редактирование существующих задач
  - Удаление задач
  - Отметка задач как выполненных
  - Фильтрация по статусу (все/активные/выполненные)
  - Система приоритетов (высокий/средний/низкий)
  - Счетчик активных задач
- Адаптивный дизайн с современным UI
- Стили и конфигурационные файлы

### 3. utils-lib

Создает библиотеку утилитарных функций с опциональными тестами и Storybook.

**Использование:**
```bash
nx generate utils-lib <название> [опции]
```

**Параметры:**
- `name` (обязательный) — название библиотеки
- `category` — категория (libs, tools, shared)
- `description` — описание библиотеки
- `includeTests` — включить тесты (по умолчанию: true)
- `includeStorybook` — включить Storybook (по умолчанию: false)

**Примеры:**
```bash
# Создать базовую библиотеку утилит
nx generate utils-lib common-utils --category=libs

# Создать библиотеку с описанием и тестами
nx generate utils-lib string-helpers --description="Утилиты для работы со строками" --includeTests=true --category=libs

# Создать библиотеку со Storybook
nx generate utils-lib ui-helpers --category=shared --includeStorybook=true
```

**Создает:**
- Утилитарную библиотеку в `micro-repos/libs/<название>/`
- Набор полезных утилитарных функций:
  - `toCamelCase` — преобразование в camelCase
  - `toKebabCase` — преобразование в kebab-case
  - `delay` — асинхронная задержка
  - `isEmpty` — проверка на пустоту
  - `deepClone` — глубокое клонирование объектов
- Тесты для всех функций (если включены)
- README с документацией
- TypeScript конфигурация

## Команды для работы с проектами

### Просмотр всех проектов
```bash
nx show projects
```

### Запуск приложения
```bash
nx serve <название-проекта>
# Например: nx serve micro-repos-apps-my-counter
```

### Сборка проекта
```bash
nx build <название-проекта>
```

### Запуск тестов
```bash
# Юнит-тесты
nx test <название-проекта>

# E2E тесты
nx e2e <название-проекта>-e2e
```

### Линтинг
```bash
nx lint <название-проекта>
```

## Особенности архитектуры

### Автоматическая организация файлов

Все генераторы автоматически:
- Размещают проекты в правильной структуре папок
- Настраивают корректные пути в конфигурационных файлах
- Создают соответствующие E2E тесты в отдельной папке
- Обновляют зависимости и метаданные проекта

### Исправление путей

Генераторы автоматически исправляют пути в:
- `tsconfig.json` — для корректного наследования базовой конфигурации
- `project.json` — для правильных схем и sourceRoot
- E2E конфигурациях — для корректной работы тестов

### Именование проектов

Проекты автоматически получают префиксы:
- Приложения: `micro-repos-apps-<название>`
- Библиотеки: `micro-repos-libs-<название>`
- E2E тесты: `micro-repos-apps-<название>-e2e`

## Разработка и расширение

### Создание нового генератора

1. Создайте файл генератора в `workspace-generators/`
2. Определите схему в соответствующем JSON файле
3. Зарегистрируйте генератор в `generators.json`
4. Создайте шаблоны в папке `<генератор>-files/`

### Структура генератора

```typescript
export async function myGenerator(
  tree: Tree,
  options: MyGeneratorSchema
) {
  // Логика создания проекта
  await formatFiles(tree);
  return () => {
    installPackagesTask(tree);
  };
}
```

## Примеры использования

### Создание счетчика

```bash
# Создать приложение счетчика
nx generate counter-app my-counter --category=apps

# Запустить приложение
nx serve <полное-название-проекта>
```

### Создание todo приложения

```bash
# Создать todo приложение с полным функционалом
nx generate todo-app my-todo --title="Мои задачи" --category=apps

# Запустить приложение
nx serve <полное-название-проекта>
```

### Создание утилитарной библиотеки

```bash
# Создать библиотеку утилит
nx generate utils-lib shared-helpers --description="Общие утилиты" --category=libs

# Использовать в других проектах
# import { toCamelCase } from '@<workspace-name>/shared-helpers';
```

## Полезные команды Nx

```bash
# Показать граф зависимостей
nx graph

# Показать информацию о проекта
nx show project <название-проекта>

# Запустить команду для всех проектов
nx run-many --target=build --all

# Запустить команду только для измененных проектов
nx affected --target=test

# Очистить кэш
nx reset
```

---

**Примечание:** Этот workspace настроен для эффективной разработки микро-приложений с автоматизированным управлением структурой проекта и зависимостями.
